<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" type="text/css" href="style.css">
	<link href='http://fonts.googleapis.com/css?family=Oleo+Script' rel='stylesheet' type='text/css'>
	<title>听写</title>
	<meta charset="utf-8"/>
</head>
<body>
	<h1>听写练习</h1>
	<div id="selectFileScreen">
		<input type="file" name="file" id="file"/>
		</br>
		<div id="link"><a href="https://drive.google.com/folderview?id=0B9-5i8bCVhE3ZnJRS1ZJOVUtRFk&usp=sharing">Download lessons here!</a></div>
		</br>
		<p class="heading">HOW TO USE:</p>
		1.) Download a handwriting tool thing. 
		<p><a href="https://support.apple.com/kb/PH21553?locale=en_US&viewlocale=en_US">Click here for Mac</a></p>
		<p><a href="http://www.pinyinjoe.com/windows-10/windows-10-chinese-handwriting-speech-display-language-packs.htm">Click here for Windows</a></p>
		<p>2.) Download a lesson from the above link.</p>
		<p>3.) Upload it onto this webpage.</p>
		<p>4.) Open your handwriting tool and write characters into the textbox.</p>
		<p>5.) Press enter.</p>
		<p>6.) Profit.</p>

	</div>
	<div id="tingxieScreen">
		<div id="pinyin"></div>
		<input type="text" name="answer" id="answer" onkeyup="return checkEnter(event)"/>
		<div id="correct"></div>
	</div>
	<div id="scoreScreen">
		<h2>Words you got wrong: </h2>
		<h2 id="numCorrect">Correct: </h2>
		<h2 id="numWrong">Total: </h2>
		<h2 id="yourScore">Your score is: </h2>
	</div>
	<script>
		var input;
		var lines;
		var line = 0;
		var result = document.getElementById('correct');
		var numCorrect = 0;
		var numWrong = 0;
		var score;

		function checkEnter(e) 
		{
			if (e.keyCode == 13) {
				getInput();
				return false;
			}
		}

		function updateChar(string) 
		{
			document.getElementById('pinyin').innerHTML = string;
		}

		document.getElementById('file').onchange = function() 
		{
  			var file = this.files[0];
  			var reader = new FileReader();

  			reader.onload = function(progressEvent){
				lines = this.result.split('\n');
			  	updateChar(lines[0]);
  			};
  			reader.readAsText(file);
  			document.getElementById('tingxieScreen').style.display = 'inline';
  			document.getElementById('selectFileScreen').style.display = 'none';
		}

		function score()
		{
			score = numCorrect / (numCorrect + numWrong);
			return;
		}

    	function getInput() 
    	{
			input = document.getElementById('answer');

			if (input.value == lines[line + 1]) {
				result.style.color = "green";
				result.innerHTML = "Correct!";
				numCorrect++;
			} else {
				result.innerHTML = "Incorrect!";
				result.style.color = "red";
				numWrong++;
			}
			line=line+2;
			if (line === lines.length) {
				document.getElementById('tingxieScreen').style.display = 'none';
				document.getElementById('scoreScreen').style.display = "inline";
				score();
				document.getElementById('yourScore').innerHTML += score.toFixed(2);
				document.getElementById('numCorrect').innerHTML += numCorrect.toFixed(2);
				document.getElementById('numWrong').innerHTML += (numWrong + numCorrect).toFixed(2);
				return;
			}
			updateChar(lines[line]);
			input.value = '';
		}
	</script>
</body>
</html>